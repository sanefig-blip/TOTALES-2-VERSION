<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Unidades de Bomberos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        background-color: #111827; /* bg-gray-900 */
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.1.1",
    "react-dom/client": "https://esm.sh/react-dom@19.1.1/client",
    "react/": "https://esm.sh/react@^19.1.1/"
  }
}
</script>
</head>
  <body>
    <div id="root"></div>
    <!-- Load Babel to transpile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Inlined React Application -->
    <script type="text/babel" data-presets="react,typescript" data-type="module">
import React, { useState, useCallback, useMemo, useEffect } from 'react';
import ReactDOM from 'react-dom/client';

// --- From types.ts ---
const UnitStatus = {
    InService: 'In Service',
    InServiceActive: 'In Service Active',
    OutOfService: 'Out of Service',
    Reserve: 'Reserve',
    OnLoan: 'On Loan',
    Alternative: 'Alternative',
};

// --- From components/icons/Icons.tsx ---
const UserIcon = ({ className }) => (
    <svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
    </svg>
);
const UsersIcon = ({ className }) => (
    <svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm6-11a4 4 0 11-8 0 4 4 0 018 0z" />
    </svg>
);
const FileTextIcon = ({ className }) => (
    <svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
    </svg>
);
const ListIcon = ({ className }) => (
    <svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
    </svg>
);
const BookIcon = ({ className }) => (
    <svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M22 3.878v16.244a2 2 0 01-2 2H4a2 2 0 01-2-2V3.878A2 2 0 014 2h16a2 2 0 012 1.878zM18 9H6M18 5H6" />
    </svg>
);
const LogOutIcon = ({ className }) => (
    <svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
    </svg>
);
const ArrowRightIcon = ({ className }) => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className={className}>
    <path strokeLinecap="round" strokeLinejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
  </svg>
);
const CogIcon = ({ className }) => (
    <svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
    </svg>
);
const PlusIcon = ({ className }) => (
    <svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
    </svg>
);
const EditIcon = ({ className }) => (
    <svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z" />
    </svg>
);
const XIcon = ({ className }) => (
    <svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
    </svg>
);
const SearchIcon = ({ className }) => (
    <svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
    </svg>
);
const TrashIcon = ({ className }) => (
    <svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" >
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
    </svg>
);
const CheckIcon = ({ className }) => (
    <svg className={className} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
    </svg>
);

// --- From data/mockData.ts ---
const PERSONNEL_DATA = [
    { lp: '71.820', rank: 'Capitan', lastName: 'Schreiner', firstName: 'Maximiliano G.' },
    { lp: '71.020', rank: 'Bro. Cdo', lastName: 'Cano', firstName: '' },
    { lp: '1159704458', rank: 'Teniente', lastName: 'Guerrero', firstName: '' },
    { lp: '1143265670', rank: 'Teniente', lastName: 'Candia', firstName: '' },
    { lp: '1133807790', rank: 'Bro. Cdo', lastName: 'Methey Doret', firstName: '' },
    { lp: '1153628440', rank: 'Teniente', lastName: 'Fernandez', firstName: '' },
    { lp: '71.441', rank: 'Capitan', lastName: 'Chiardi', firstName: 'Adrian M.' },
    { lp: '73.410', rank: 'Capitan', lastName: 'Gimenez Almada', firstName: 'Matias L.' },
    { lp: '60.126', rank: 'Capitan', lastName: 'Sanchez', firstName: 'Carlos A.' },
    { lp: 'placeholder-lp-1', rank: 'Capitan', lastName: 'Padilla', firstName: '' },
    { lp: 'placeholder-lp-2', rank: 'Bro. Sup', lastName: 'Gamarra', firstName: '' },
    { lp: 'placeholder-lp-3', rank: 'Bro. Sup', lastName: 'Artaza', firstName: '' },
    { lp: 'placeholder-lp-4', rank: 'Bro. Sup', lastName: 'Blanco', firstName: '' },
    { lp: 'placeholder-lp-5', rank: 'Subtte', lastName: 'Rocha', firstName: '' },
    { lp: 'placeholder-lp-6', rank: 'Capitan', lastName: 'Hermann', firstName: '' },
    { lp: 'placeholder-lp-7', rank: 'Teniente', lastName: 'Cabanelas', firstName: '' },
    { lp: 'placeholder-lp-8', rank: 'Capitan', lastName: 'Nittolo', firstName: '' },
    { lp: 'placeholder-lp-9', rank: 'Subteniente', lastName: 'Ventieri', firstName: '' },
    { lp: 'placeholder-lp-10', rank: 'Bro. Calif.', lastName: 'Ruiz Diaz', firstName: '' },
    { lp: 'placeholder-lp-11', rank: 'Bro. Sup.', lastName: 'Galvan', firstName: '' },
    { lp: 'placeholder-lp-12', rank: 'Teniente', lastName: 'Correa', firstName: '' },
    { lp: 'placeholder-lp-13', rank: 'Subteniente', lastName: 'Solari', firstName: '' },
    { lp: 'placeholder-lp-14', rank: 'Teniente', lastName: 'Zurita', firstName: '' },
    { lp: 'placeholder-lp-15', rank: 'Bro. Sup', lastName: 'Moreno', firstName: '' },
    { lp: 'placeholder-lp-16', rank: 'Teniente', lastName: 'San Pedro', firstName: '' },
    { lp: 'placeholder-lp-17', rank: 'Teniente', lastName: 'Cardama', firstName: '' },
    { lp: 'placeholder-lp-18', rank: 'Teniente', lastName: 'Romeo', firstName: '' },
    { lp: 'placeholder-lp-19', rank: 'Bro. Sup.', lastName: 'Franco', firstName: '' },
    { lp: 'placeholder-lp-20', rank: 'Teniente', lastName: 'Barros', firstName: '' },
    { lp: 'placeholder-lp-21', rank: 'Bro. Cdo.', lastName: 'Picasso', firstName: '' },
    { lp: 'placeholder-lp-22', rank: 'Bro. Cdo', lastName: 'Mayor', firstName: '' },
    { lp: 'placeholder-lp-23', rank: 'Teniente', lastName: 'Farias', firstName: '' },
    { lp: 'placeholder-lp-24', rank: 'Teniente', lastName: 'Reynoso', firstName: '' },
    { lp: 'placeholder-lp-25', rank: 'Teniente', lastName: 'Mahmud', firstName: '' },
    { lp: 'placeholder-lp-26', rank: 'Bro Cdo', lastName: 'Jaureguiberry', firstName: '' },
    { lp: 'placeholder-lp-27', rank: 'Bro Cdo', lastName: 'Ordoñez', firstName: '' },
    { lp: 'placeholder-lp-28', rank: 'Teniente', lastName: 'Acevedo', firstName: '' },
    { lp: 'placeholder-lp-29', rank: 'Subtte.', lastName: 'Chocobar', firstName: '' },
    { lp: 'placeholder-lp-30', rank: 'Bro. Sup', lastName: 'Martino', firstName: '' },
    { lp: 'placeholder-lp-31', rank: 'Bro. Cdo', lastName: 'Osman', firstName: '' },
    { lp: 'placeholder-lp-32', rank: 'Teniente', lastName: 'Day Vivas', firstName: '' },
    { lp: 'placeholder-lp-33', rank: 'Bro Sup.', lastName: 'Rivero', firstName: '' },
    { lp: 'placeholder-lp-34', rank: 'Subtte', lastName: 'Ramirez', firstName: '' },
    { lp: 'placeholder-lp-35', rank: 'Subtte', lastName: 'Garcia', firstName: '' },
    { lp: 'placeholder-lp-36', rank: 'Teniente', lastName: 'Freire', firstName: '' },
    { lp: 'placeholder-lp-37', rank: 'Capitan', lastName: 'Ferreiro Vargas', firstName: '' },
    { lp: 'placeholder-lp-38', rank: 'Capitan', lastName: 'Di Mango', firstName: '' },
    { lp: 'placeholder-lp-39', rank: 'Capitan', lastName: 'Meaolo', firstName: '' },
    { lp: 'placeholder-lp-40', rank: 'Subtte.', lastName: 'Castelli', firstName: '' },
    { lp: 'placeholder-lp-41', rank: 'Bro. Sup', lastName: 'Avelino', firstName: '' },
    { lp: 'placeholder-lp-42', rank: 'Bro. Sup', lastName: 'Colarossi', firstName: '' },
    { lp: 'placeholder-lp-43', rank: 'Teniente', lastName: 'Muzzicato', firstName: '' },
    { lp: 'placeholder-lp-44', rank: 'Subteniente', lastName: 'Brandan', firstName: '' },
    { lp: 'placeholder-lp-45', rank: 'Teniente', lastName: 'Douat', firstName: '' },
    { lp: 'placeholder-lp-46', rank: 'Teniente', lastName: 'Rios', firstName: '' },
    { lp: 'placeholder-lp-47', rank: 'Subteniente', lastName: 'Pistoia', firstName: '' },
    { lp: 'placeholder-lp-48', rank: 'Inspector', lastName: 'Di Mango', firstName: '' },
    { lp: 'placeholder-lp-49', rank: 'Subinspector', lastName: 'Arbe', firstName: '' },
    { lp: 'placeholder-lp-50', rank: 'Ayudante', lastName: 'Tevez', firstName: '' },
];
const ZONES_DATA = [
    {
        id: 'zona-i',
        name: 'ZONA I',
        stations: [
            {
                id: 'estacion-i-puerto-madero',
                name: 'ESTACIÓN I PUERTO MADERO',
                units: [
                    { id: 'IV-2638', type: 'Autobomba', status: UnitStatus.InService, officerInCharge: { rank: 'Capitan', name: 'Schreiner', lp: '71.820' }, personnelCount: 8 },
                    { id: 'FR-2105', type: 'Camioneta', status: UnitStatus.InService, officerInCharge: { rank: 'Bro. Cdo', name: 'Cano', lp: '71.020' }, personnelCount: 1 },
                    { id: 'FZ-2666', type: 'Unidad Liviana', status: UnitStatus.InService, officerInCharge: null, personnelCount: null },
                    { id: 'BICICLETA-276', type: 'Bicicleta', status: UnitStatus.InService, officerInCharge: null, personnelCount: null },
                    { id: 'BICICLETA-277', type: 'Bicicleta', status: UnitStatus.InService, officerInCharge: null, personnelCount: null },
                    { id: 'POLARIS-6441', type: 'Cuatriciclo', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'BICICLETA-275', type: 'Bicicleta', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null, statusReason: 'Rueda pinchada' },
                    { id: 'YAM-3981', type: 'Cuatriciclo', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'POLARIS-3236', type: 'Cuatriciclo', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                ]
            },
            {
                id: 'estacion-ii-patricios',
                name: 'ESTACIÓN II PATRICIOS',
                units: [
                    { id: 'IV-2640', type: 'Autobomba', status: UnitStatus.InService, officerInCharge: { rank: 'Teniente', name: 'Guerrero', lp: '1159704458' }, personnelCount: 3 },
                    { id: 'IV-9005', type: 'Cisterna', status: UnitStatus.InService, officerInCharge: { rank: 'Teniente', name: 'Candia', lp: '1143265670' }, personnelCount: 3 },
                    { id: 'FR-2107', type: 'Camioneta', status: UnitStatus.InService, officerInCharge: { rank: 'Bro. Cdo.', name: 'Methey Doret', lp: '1133807790' }, personnelCount: 1 },
                    { id: 'ZFD-2680', type: 'Autobomba Liviana', status: UnitStatus.InService, officerInCharge: { rank: 'Teniente', name: 'Fernandez', lp: '1153628440' }, personnelCount: 1 },
                    { id: 'BER-1168', type: 'BERLINGO', status: UnitStatus.OnLoan, officerInCharge: null, personnelCount: null },
                    { id: 'MB-2672', type: 'Autobomba', status: UnitStatus.OnLoan, officerInCharge: null, personnelCount: null },
                    { id: 'ZONDA-2656', type: 'Autobomba Liviana', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'MB-2651', type: 'Autobomba', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null, statusReason: 'Problema de motor' },
                    { id: 'CAT-DISEL', type: 'Iluminación', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                ]
            },
            {
                id: 'destacamento-pompeya',
                name: 'DESTACAMENTO POMPEYA',
                units: [
                    { id: 'MB-9173', type: 'Autobomba', status: UnitStatus.InService, officerInCharge: { rank: 'Teniente', name: 'Fernandez', lp: '1153628440' }, personnelCount: 4 },
                ]
            },
            {
                id: 'estacion-iii-barracas',
                name: 'ESTACIÓN III BARRACAS',
                units: [
                    { id: 'IV-2641', type: 'Autobomba', status: UnitStatus.InService, officerInCharge: { rank: 'Capitan', name: 'Padilla', lp: 'placeholder-lp-1' }, personnelCount: 9 },
                    { id: 'IV-9000', type: 'Cisterna', status: UnitStatus.InService, officerInCharge: { rank: 'Bro. Sup', name: 'Gamarra', lp: 'placeholder-lp-2' }, personnelCount: 3 },
                    { id: 'FR-2125', type: 'Camioneta', status: UnitStatus.InService, officerInCharge: { rank: 'Bro. Sup', name: 'Artaza', lp: 'placeholder-lp-3' }, personnelCount: 1 },
                    { id: 'ZONDA-2665', type: 'Autobomba Liviana', status: UnitStatus.InService, officerInCharge: { rank: 'Bro. Sup', name: 'Blanco', lp: 'placeholder-lp-4' }, personnelCount: 2 },
                    { id: 'MB-2662', type: 'Autobomba', status: UnitStatus.OnLoan, officerInCharge: null, personnelCount: null },
                    { id: 'YAM-3982', type: 'Cuatriciclo', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                ]
            },
            {
                id: 'destacamento-boca',
                name: 'DESTACAMENTO BOCA',
                units: [
                    { id: 'AGRALE-8371', type: 'Autobomba', status: UnitStatus.InService, officerInCharge: { rank: 'Subtte', name: 'Rocha', lp: 'placeholder-lp-5' }, personnelCount: 5 },
                    { id: 'MB-2660', type: 'Autobomba', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'ALLIGHT-4608', type: 'Iluminación', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                ]
            },
            {
                id: 'estacion-x-lugano',
                name: 'ESTACIÓN X LUGANO',
                units: [
                    { id: 'MB-2675', type: 'Autobomba', status: UnitStatus.InService, officerInCharge: { rank: 'Capitan', name: 'Hermann', lp: 'placeholder-lp-6' }, personnelCount: 10 },
                    { id: 'F.R.-2123', type: 'Camioneta', status: UnitStatus.InService, officerInCharge: { rank: 'Teniente', name: 'Cabanelas', lp: 'placeholder-lp-7' }, personnelCount: 2 },
                    { id: 'YAM-3986', type: 'Cuatriciclo', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'MB-2674', type: 'Autobomba', status: UnitStatus.OnLoan, officerInCharge: null, personnelCount: null },
                    { id: 'ZONDA-2668', type: 'Autobomba Liviana', status: UnitStatus.OnLoan, officerInCharge: null, personnelCount: null },
                    { id: '4751', type: 'Bote', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'YAM-3985', type: 'Cuatriciclo', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'F.C-2659', type: 'Cisterna', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'IV-170 P.M.A', type: 'Hidroelevador', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'ALLIGHT', type: 'Iluminación', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'MB-9174', type: 'Autobomba', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'F.R.-2826', type: 'Camioneta', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                ]
            }
        ]
    },
    {
        id: 'zona-ii',
        name: 'ZONA II',
        stations: [
            {
                id: 'estacion-iv-recoleta',
                name: 'ESTACIÓN IV RECOLETA',
                units: [
                    { id: 'IV-2635', type: 'Autobomba', status: UnitStatus.InService, officerInCharge: { rank: 'Capitan', name: 'Nittolo', lp: 'placeholder-lp-8' }, personnelCount: 10 },
                    { id: 'FC-2669', type: 'Cisterna', status: UnitStatus.InService, officerInCharge: { rank: 'Subteniente', name: 'Ventieri', lp: 'placeholder-lp-9' }, personnelCount: 2 },
                    { id: 'F.R. 2126', type: 'Camioneta', status: UnitStatus.InService, officerInCharge: { rank: 'Bro. Calif.', name: 'Ruiz Diaz', lp: 'placeholder-lp-10' }, personnelCount: 1 },
                    { id: 'IV-2642', type: 'Autobomba', status: UnitStatus.OutOfService, officerInCharge: { rank: 'Bro. Sup.', name: 'Galvan', lp: 'placeholder-lp-11' }, personnelCount: 1 },
                    { id: 'BER-1166', type: 'BERLINGO', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'HIFEI S/N°', type: 'Gomon', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'CATERPILLAR', type: 'Iluminación', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'YAM-3983', type: 'Cuatriciclo', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'AGRALE-8371-2', type: 'Autobomba', status: UnitStatus.OnLoan, officerInCharge: null, personnelCount: null },
                ]
            },
            {
                id: 'destacamento-miserere',
                name: 'DESTACAMENTO MISERERE',
                units: [
                    { id: 'MB-2673', type: 'Autobomba', status: UnitStatus.InService, officerInCharge: { rank: 'Teniente', name: 'Correa', lp: 'placeholder-lp-12' }, personnelCount: 9 },
                ]
            },
            {
                id: 'destacamento-retiro',
                name: 'DESTACAMENTO RETIRO',
                units: [
                    { id: 'ZFD-2658', type: 'Autobomba Liviana', status: UnitStatus.InService, officerInCharge: { rank: 'Subteniente', name: 'Solari', lp: 'placeholder-lp-13' }, personnelCount: 3 },
                ]
            },
             {
                id: 'destacamento-palermo',
                name: 'DESTACAMENTO PALERMO',
                units: []
            },
            {
                id: 'estacion-v-cte-gral-a-vazquez',
                name: 'ESTACIÓN V CTE. GRAL. A. VAZQUEZ',
                units: [
                    { id: 'MB-2653', type: 'Autobomba', status: UnitStatus.InService, officerInCharge: { rank: 'Capitan', name: 'Correa', lp: 'placeholder-lp-12' }, personnelCount: 8 },
                    { id: 'FC-2667', type: 'Cisterna', status: UnitStatus.InService, officerInCharge: { rank: 'Teniente', name: 'Zurita', lp: 'placeholder-lp-14' }, personnelCount: 3 },
                    { id: 'FR-2106', type: 'Camioneta', status: UnitStatus.InService, officerInCharge: { rank: 'Bro. Sup', name: 'Moreno', lp: 'placeholder-lp-15' }, personnelCount: 1 },
                    { id: 'FR-2110', type: 'Camioneta', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'BER-1161', type: 'BERLINGO', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'HIFEI S/N°-2', type: 'Gomon', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'MERCURY-4752', type: 'Motor', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'YAMAHA-4749', type: 'Gomon', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'YAMAHA-3987', type: 'Cuatriciclo', status: UnitStatus.OnLoan, officerInCharge: null, personnelCount: null },
                    { id: 'ALLIGHT-96', type: 'Iluminación', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                ]
            },
            {
                id: 'destacamento-urquiza',
                name: 'DESTACAMENTO URQUIZA',
                units: [
                    { id: 'MB-2660-2', type: 'Autobomba', status: UnitStatus.InService, officerInCharge: { rank: 'Teniente', name: 'San Pedro', lp: 'placeholder-lp-16' }, personnelCount: 6 },
                    { id: 'IV-2636', type: 'Autobomba', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'BIM - 3067', type: 'Gomon', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                ]
            },
            {
                id: 'destacamento-saavedra',
                name: 'DESTACAMENTO SAAVEDRA',
                units: [
                    { id: 'MB-2672-2', type: 'Autobomba', status: UnitStatus.InService, officerInCharge: { rank: 'Teniente', name: 'Cardama', lp: 'placeholder-lp-17' }, personnelCount: 5 },
                ]
            },
            {
                id: 'estacion-vi-crio-mayor-m-firma-paz',
                name: 'ESTACIÓN VI CRÍO. MAYOR M. FIRMA PAZ',
                units: [
                    { id: 'IV-2643', type: 'Autobomba', status: UnitStatus.InService, officerInCharge: { rank: 'Teniente', name: 'Romeo', lp: 'placeholder-lp-18' }, personnelCount: 9 },
                    { id: 'FORD-9052', type: 'Hidroelevador', status: UnitStatus.InService, officerInCharge: { rank: 'Bro. Sup.', name: 'Franco', lp: 'placeholder-lp-19' }, personnelCount: 2 },
                    { id: 'IV-9004', type: 'Cisterna', status: UnitStatus.InService, officerInCharge: { rank: 'Teniente', name: 'Barros', lp: 'placeholder-lp-20' }, personnelCount: 3 },
                    { id: 'JUMPER 2138', type: 'U.A.R.', status: UnitStatus.InService, officerInCharge: { rank: 'Bro. Cdo.', name: 'Picasso', lp: 'placeholder-lp-21' }, personnelCount: 2 },
                    { id: 'FR-2118', type: 'Camioneta', status: UnitStatus.InService, officerInCharge: { rank: 'Bro. Cdo', name: 'Mayor', lp: 'placeholder-lp-22' }, personnelCount: 1 },
                    { id: 'ALLIGHT-2', type: 'Iluminación', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'FORD-2681', type: 'Usina', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'MB-2673-2', type: 'Autobomba', status: UnitStatus.OnLoan, officerInCharge: null, personnelCount: null },
                    { id: 'ZONDA-2666', type: 'Autobomba Liviana', status: UnitStatus.OnLoan, officerInCharge: null, personnelCount: null },
                    { id: 'MB-2675-2', type: 'Autobomba', status: UnitStatus.OnLoan, officerInCharge: null, personnelCount: null },
                    { id: 'C.BER-1171', type: 'Unidad Liviana', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'IV-9051', type: 'Hidroelevador', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'MB-2677', type: 'Autobomba', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'FZ-2657', type: 'Unidad Liviana', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'POLARIS-3237', type: 'Sexticiclo', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                ]
            },
            {
                id: 'destacamento-chacarita',
                name: 'DESTACAMENTO CHACARITA',
                units: [
                    { id: 'ZONDA-2668-2', type: 'Autobomba Liviana', status: UnitStatus.InService, officerInCharge: { rank: 'Teniente', name: 'Reynoso', lp: 'placeholder-lp-24' }, personnelCount: 3 },
                    { id: 'IV-2637', type: 'Autobomba', status: UnitStatus.InService, officerInCharge: { rank: 'Teniente', name: 'Farias', lp: 'placeholder-lp-23' }, personnelCount: 7 },
                ]
            },
        ]
    },
    {
        id: 'zona-iii',
        name: 'ZONA III',
        stations: [
            {
                id: 'estacion-ix-versailles',
                name: 'ESTACIÓN IX VERSAILLES',
                units: [
                    { id: 'IV-2745', type: 'Autobomba', status: UnitStatus.InService, officerInCharge: { rank: 'Teniente', name: 'Mahmud', lp: 'placeholder-lp-25' }, personnelCount: 7 },
                    { id: 'FR-2122', type: 'Camioneta', status: UnitStatus.InService, officerInCharge: { rank: 'Bro Cdo', name: 'Jaureguiberry', lp: 'placeholder-lp-26' }, personnelCount: 2 },
                    { id: 'BER-1212', type: 'BERLINGO', status: UnitStatus.InService, officerInCharge: { rank: 'Bro Cdo', name: 'Ordoñez', lp: 'placeholder-lp-27' }, personnelCount: 2 },
                    { id: 'HIFEI-450495', type: 'Bote Semirrígido', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'BIM-S/N°', type: 'Bote Inflable', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'NIGHTSHIFTER', type: 'Iluminación', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'FC-2671', type: 'Cisterna', status: UnitStatus.OnLoan, officerInCharge: null, personnelCount: null },
                    { id: 'MB-2676', type: 'Autobomba', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                ]
            },
            {
                id: 'destacamento-devoto',
                name: 'DESTACAMENTO DEVOTO',
                units: [
                    { id: 'MB-2674-2', type: 'Autobomba', status: UnitStatus.InService, officerInCharge: { rank: 'Teniente', name: 'Acevedo', lp: 'placeholder-lp-28' }, personnelCount: 8 },
                ]
            },
            {
                id: 'estacion-vii-flores',
                name: 'ESTACIÓN VII FLORES',
                units: [
                    { id: 'MB-2654', type: 'Autobomba', status: UnitStatus.InService, officerInCharge: { rank: 'Capitan', name: 'Chiardi', lp: '71.441' }, personnelCount: 10 },
                    { id: 'VW-9319', type: 'Cisterna', status: UnitStatus.InService, officerInCharge: { rank: 'Subtte.', name: 'Chocobar', lp: 'placeholder-lp-29' }, personnelCount: 2 },
                    { id: 'FR-2121', type: 'Camioneta', status: UnitStatus.InService, officerInCharge: { rank: 'Bro. Sup', name: 'Martino', lp: 'placeholder-lp-30' }, personnelCount: 2 },
                    { id: 'BER-1220', type: 'BERLINGO', status: UnitStatus.OnLoan, officerInCharge: null, personnelCount: null },
                    { id: 'FORD-9052-2', type: 'Hidroelevador', status: UnitStatus.OnLoan, officerInCharge: null, personnelCount: null },
                    { id: 'CAT-S/N°', type: 'Iluminación', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'IV-2639', type: 'Autobomba', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: '40 HP 4595', type: 'Semirrígido', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                ]
            },
            {
                id: 'estacion-viii-nueva-chicago',
                name: 'ESTACIÓN VIII NUEVA CHICAGO',
                units: [
                    { id: 'MB-346', type: 'Autobomba', status: UnitStatus.InService, officerInCharge: { rank: 'Capitan', name: 'Gimenez Almada', lp: '73.410' }, personnelCount: 8 },
                    { id: 'F. R.-2129', type: 'Camioneta', status: UnitStatus.InService, officerInCharge: { rank: 'Bro. Cdo', name: 'Osman', lp: 'placeholder-lp-31' }, personnelCount: 2 },
                    { id: 'FC-2670', type: 'Cisterna', status: UnitStatus.OnLoan, officerInCharge: null, personnelCount: 2 },
                    { id: 'BER-1184', type: 'BERLINGO', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'HIFEI-4726', type: 'Bote', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'F. TRANSIT-8353', type: 'Unidad Médica', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'F. TRANSIT-8354', type: 'Unidad Médica', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'MB-347', type: 'Autobomba', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'ALLIGHT-3', type: 'Iluminación', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                ]
            },
            {
                id: 'destacamento-velez-sarsfield',
                name: 'DESTACAMENTO VELEZ SARSFIELD',
                units: [
                    { id: 'FC-2671-2', type: 'Autobomba', status: UnitStatus.InService, officerInCharge: { rank: 'Teniente', name: 'Sanchez', lp: '60.126' }, personnelCount: 3 },
                ]
            },
            {
                id: 'estacion-xi-albarino',
                name: 'ESTACIÓN XI ALBARIÑO',
                units: [
                    { id: 'FC-2670-2', type: 'Cisterna', status: UnitStatus.InService, officerInCharge: { rank: 'Capitan', name: 'Aranda', lp: '70.895' }, personnelCount: 3 },
                    { id: 'ALLIGHT-4', type: 'Iluminación', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'MB 9173', type: 'Autobomba', status: UnitStatus.OnLoan, officerInCharge: null, personnelCount: null },
                    { id: 'ZONDA-2665-2', type: 'Autobomba Liviana', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'IV-9051-2', type: 'Hidroelevador', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                ]
            }
        ]
    },
    {
        id: 'unidades-especiales',
        name: 'UNIDADES ESPECIALES',
        stations: [
            {
                id: 'brigada-de-emergencias-especiales',
                name: 'BRIGADA DE EMERGENCIAS ESPECIALES',
                units: [
                    { id: 'C.JUMP-2152', type: 'Camioneta', status: UnitStatus.InService, officerInCharge: { rank: 'Teniente', name: 'Day Vivas', lp: 'placeholder-lp-32' }, personnelCount: 1 },
                    { id: 'FR-2109', type: 'Camioneta', status: UnitStatus.InService, officerInCharge: { rank: 'Bro Sup.', name: 'Rivero', lp: 'placeholder-lp-33' }, personnelCount: 1 },
                    { id: 'C.JUMP. 1170', type: 'Camioneta', status: UnitStatus.InService, officerInCharge: { rank: 'Subtte', name: 'Ramirez', lp: 'placeholder-lp-34' }, personnelCount: 3 },
                ]
            },
            {
                id: 'destacamento-sistema-de-asistencia-critica',
                name: 'DESTACAMENTO SISTEMA DE ASISTENCIA CRITICA',
                units: [
                    { id: 'JUMPER-2149', type: 'Unidad Médica', status: UnitStatus.InService, officerInCharge: { rank: 'Subtte', name: 'Garcia', lp: 'placeholder-lp-35' }, personnelCount: 1 },
                    { id: 'F.R. 2114', type: 'Prensa', status: UnitStatus.InService, officerInCharge: { rank: 'Teniente', name: 'Freire', lp: 'placeholder-lp-36' }, personnelCount: 2 },
                ]
            },
            {
                id: 'dto-ger-1-caballito',
                name: 'DTO. G.E.R. 1 CABALLITO',
                units: [
                    { id: 'IV-2644', type: 'Autobomba', status: UnitStatus.InService, officerInCharge: { rank: 'Capitan', name: 'Ferreiro Vargas', lp: 'placeholder-lp-37' }, personnelCount: 5 },
                    { id: 'F.R 2111 C/D', type: 'Camioneta', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'F.R 2132 C/S', type: 'Camioneta', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'HI-FEI S/N°', type: 'Balsa Inflable', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'SEM. GALLO BIM', type: 'Semirrígido', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'MB-9157', type: 'Autobomba', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'BIM CORINA', type: 'Semirrígido', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'HIGHFIELD', type: 'Semirrígido', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'ALLIGHT-5', type: 'Iluminación', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'MARINER 4725', type: 'Motor S/Emb', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'JOHNSON 4479', type: 'Motor S/Emb', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                ]
            },
            {
                id: 'dto-ger-2-saavedra',
                name: 'DTO. G.E.R. 2 SAAVEDRA',
                units: [
                    { id: 'IV-9351', type: 'Autobomba', status: UnitStatus.InService, officerInCharge: { rank: 'Capitan', name: 'Di Mango', lp: 'placeholder-lp-38' }, personnelCount: 8 },
                    { id: 'F. R.-2130', type: 'Camioneta', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'TOHATSU 4T', type: 'Embarcación', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'BIM S/N°-2', type: 'Semirrígido', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'HI-FEI S/N°-3', type: 'Balsa Inflable', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'ALLIGHT-6', type: 'Iluminación', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                ]
            },
            {
                id: 'estacion-busqueda-y-rescate-k9',
                name: 'ESTACIÓN BUSQUEDA Y RESCATE K9',
                units: [
                    { id: 'K9', type: 'Búsqueda y Rescate', status: UnitStatus.InService, officerInCharge: { rank: 'Capitan', name: 'Meaolo', lp: 'placeholder-lp-39' }, personnelCount: 2 },
                    { id: 'F.R.-8356', type: 'Camioneta', status: UnitStatus.InService, officerInCharge: { rank: 'Subtte.', name: 'Castelli', lp: 'placeholder-lp-40' }, personnelCount: 1 },
                    { id: 'K.D.H.', type: 'BERLINGO', status: UnitStatus.OnLoan, officerInCharge: null, personnelCount: null },
                ]
            },
            {
                id: 'transporte-forense',
                name: 'TRANSPORTE FORENSE',
                units: [
                    { id: 'OAI-718/2634 (F3)', type: 'Camioneta', status: UnitStatus.InService, officerInCharge: { rank: 'Bro. Sup', name: 'Avelino', lp: 'placeholder-lp-41' }, personnelCount: 2 },
                    { id: 'OAI-717/2633 (F2)', type: 'Camioneta', status: UnitStatus.InService, officerInCharge: { rank: 'Bro. Sup', name: 'Colarossi', lp: 'placeholder-lp-42' }, personnelCount: 2 },
                    { id: 'OAI-716/2632 (F1)', type: 'Camioneta', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'FHY-285-/1321 (F5)', type: 'Unidad Liviana', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'OSZ-875/930 (F8)', type: 'Camioneta', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'AA-639-AM / 1188 (CB)', type: 'Camioneta', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                ]
            },
        ]
    },
    {
        id: 'jefatura',
        name: 'JEFATURA',
        stations: [
            {
                id: 'ocob',
                name: 'O.C.O.B.',
                units: [
                    { id: 'IV-2646 P.C.M', type: 'Autobomba', status: UnitStatus.InService, officerInCharge: { rank: 'Teniente', name: 'Muzzicato', lp: 'placeholder-lp-43' }, personnelCount: 2 },
                ]
            },
            {
                id: 'oficina-de-investigacion-de-incendios-y-explosiones',
                name: 'OFICINA DE INVESTIGACION DE INCENDIOS Y EXPLOSIONES',
                units: [
                    { id: 'FR-2139 (UPM)', type: 'Camioneta', status: UnitStatus.InService, officerInCharge: { rank: 'Subteniente', name: 'Brandan', lp: 'placeholder-lp-44' }, personnelCount: 3 },
                    { id: 'FR-2117', type: 'Camioneta', status: UnitStatus.InService, officerInCharge: { rank: 'Teniente', name: 'Douat', lp: 'placeholder-lp-45' }, personnelCount: 1 },
                ]
            },
            {
                id: 'urip-centro',
                name: 'URIP CENTRO',
                units: [
                    { id: 'C.BER - 2104', type: 'Unidad Liviana', status: UnitStatus.InService, officerInCharge: { rank: 'Teniente', name: 'Rios', lp: 'placeholder-lp-46' }, personnelCount: 1 },
                ]
            },
            {
                id: 'urip-norte',
                name: 'URIP NORTE',
                units: [
                    { id: 'FR-2131', type: 'Camioneta', status: UnitStatus.InService, officerInCharge: { rank: 'Subteniente', name: 'Pistoia', lp: 'placeholder-lp-47' }, personnelCount: 1 },
                ]
            },
            {
                id: 'division-befer',
                name: 'DIVISIÓN B.E.FE.R.',
                units: [
                    { id: 'IV-2639-2', type: 'Autobomba', status: UnitStatus.InService, officerInCharge: { rank: 'Inspector', name: 'Di Mango', lp: 'placeholder-lp-48' }, personnelCount: 8 },
                    { id: 'MB-2652', type: 'Autobomba', status: UnitStatus.InService, officerInCharge: { rank: 'Subinspector', name: 'Arbe', lp: 'placeholder-lp-49' }, personnelCount: 7 },
                    { id: 'FORD-2655', type: 'Bote', status: UnitStatus.InService, officerInCharge: { rank: 'Ayudante', name: 'Tevez', lp: 'placeholder-lp-50' }, personnelCount: 3 },
                    { id: 'MERCURY 4660', type: 'Motor', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'HONDA 5184', type: 'Tornado', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'MERCURY 3102', type: 'Motor', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'ALLIGHT 4661', type: 'Iluminación', status: UnitStatus.Reserve, officerInCharge: null, personnelCount: null },
                    { id: 'PEUGEOT-361', type: 'Transporte', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'FORD-2664', type: 'Cisterna', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'IVECO 9360', type: 'Usina G.E.', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'FORD-2682', type: 'Ranger', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'FD-7796', type: 'Cuatriciclo', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'YAMAHA-3975', type: 'Ranger', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                    { id: 'F.R.-8356-2', type: 'Camioneta', status: UnitStatus.OutOfService, officerInCharge: null, personnelCount: null },
                ]
            }
        ]
    }
];

// --- From components/modals/Modal.tsx ---
const Modal = ({ isOpen, onClose, title, children, size = '2xl' }) => {
    if (!isOpen) return null;

    const sizeClasses = {
        'sm': 'max-w-sm',
        'md': 'max-w-md',
        'lg': 'max-w-lg',
        'xl': 'max-w-xl',
        '2xl': 'max-w-2xl',
        '3xl': 'max-w-3xl',
        '4xl': 'max-w-4xl',
    };

    return (
        <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
            <div className={`bg-gray-800 text-gray-200 rounded-lg shadow-xl w-full ${sizeClasses[size]} flex flex-col`}>
                <header className="flex items-center justify-between p-4 border-b border-gray-700">
                    <h2 className="text-lg font-semibold">{title}</h2>
                    <button onClick={onClose} className="p-1 rounded-full hover:bg-gray-700">
                        <XIcon className="w-6 h-6" />
                    </button>
                </header>
                <main className="p-6 overflow-y-auto">
                    {children}
                </main>
            </div>
        </div>
    );
};


// --- From components/modals/AddEditUnitModal.tsx ---
const AddEditUnitModal = ({ isOpen, onClose, onSave, unitData, allZones }) => {
    const isEditMode = unitData?.mode === 'edit';
    const initialUnit = unitData?.unit;

    const [formData, setFormData] = useState({
        id: '',
        name: '',
        internalNumber: '',
        type: '',
        zoneId: '',
        stationId: ''
    });

    const [availableStations, setAvailableStations] = useState([]);

    useEffect(() => {
        if (isOpen) {
            if (isEditMode && initialUnit) {
                setFormData({
                    id: initialUnit.id || '',
                    name: initialUnit.id || '', // Assuming name is same as id for now
                    internalNumber: initialUnit.internalNumber || '',
                    type: initialUnit.type || '',
                    zoneId: initialUnit.zoneId || '',
                    stationId: initialUnit.stationId || ''
                });
                
                if (initialUnit.zoneId) {
                    const selectedZone = allZones.find(z => z.id === initialUnit.zoneId);
                    if (selectedZone) {
                        setAvailableStations(selectedZone.stations);
                    }
                }
            } else {
                // Reset for "add" mode
                setFormData({ id: '', name: '', internalNumber: '', type: '', zoneId: '', stationId: '' });
                setAvailableStations([]);
            }
        }
    }, [isOpen, isEditMode, initialUnit, allZones]);

    const handleZoneChange = (e) => {
        const newZoneId = e.target.value;
        setFormData(prev => ({ ...prev, zoneId: newZoneId, stationId: '' }));
        const selectedZone = allZones.find(z => z.id === newZoneId);
        setAvailableStations(selectedZone ? selectedZone.stations : []);
    };

    const handleChange = (e) => {
        const { name, value } = e.target;
        setFormData(prev => ({ ...prev, [name]: value }));
    };

    const handleSubmit = (e) => {
        e.preventDefault();
        onSave(formData, initialUnit); // Pass original unit for edits
        onClose();
    };

    return (
        <Modal isOpen={isOpen} onClose={onClose} title={isEditMode ? "Editar Unidad" : "Agregar Nueva Unidad"} size="2xl">
            <form onSubmit={handleSubmit} className="space-y-6">
                <div>
                    <label htmlFor="id" className="block text-sm font-medium text-blue-300 mb-1">ID de Unidad (Único) *</label>
                    <input id="id" name="id" type="text" value={formData.id} onChange={handleChange} required disabled={isEditMode} className="w-full bg-gray-900 border border-gray-600 rounded-md p-2 focus:ring-red-500 focus:border-red-500 disabled:opacity-50" />
                </div>
                <div>
                    <label htmlFor="name" className="block text-sm font-medium text-blue-300 mb-1">Nombre de Unidad</label>
                    <input id="name" name="name" type="text" placeholder="Ej: IV-2650" value={formData.name} onChange={handleChange} className="w-full bg-gray-900 border border-gray-600 rounded-md p-2 focus:ring-red-500 focus:border-red-500" />
                </div>
                <div>
                    <label htmlFor="internalNumber" className="block text-sm font-medium text-blue-300 mb-1">Número de Interno</label>
                    <input id="internalNumber" name="internalNumber" type="text" placeholder="Ej: 351" value={formData.internalNumber} onChange={handleChange} className="w-full bg-gray-900 border border-gray-600 rounded-md p-2 focus:ring-red-500 focus:border-red-500" />
                </div>
                <div>
                    <label htmlFor="type" className="block text-sm font-medium text-blue-300 mb-1">Tipo de Unidad</label>
                    <input id="type" name="type" type="text" placeholder="Ej: Autobomba, Cisterna" value={formData.type} onChange={handleChange} required className="w-full bg-gray-900 border border-gray-600 rounded-md p-2 focus:ring-red-500 focus:border-red-500" />
                </div>
                <div className="grid grid-cols-2 gap-4">
                    <div>
                        <label htmlFor="zoneId" className="block text-sm font-medium text-blue-300 mb-1">Zona *</label>
                        <select id="zoneId" name="zoneId" value={formData.zoneId} onChange={handleZoneChange} required className="w-full bg-gray-900 border border-gray-600 rounded-md p-2 focus:ring-red-500 focus:border-red-500">
                            <option value="">Seleccione una zona...</option>
                            {allZones.map(zone => <option key={zone.id} value={zone.id}>{zone.name}</option>)}
                        </select>
                    </div>
                    <div>
                        <label htmlFor="stationId" className="block text-sm font-medium text-blue-300 mb-1">Estación / Destacamento *</label>
                        <select id="stationId" name="stationId" value={formData.stationId} onChange={handleChange} required disabled={!formData.zoneId} className="w-full bg-gray-900 border border-gray-600 rounded-md p-2 focus:ring-red-500 focus:border-red-500 disabled:opacity-50">
                            <option value="">Seleccione una estación...</option>
                            {availableStations.map(station => <option key={station.id} value={station.id}>{station.name}</option>)}
                        </select>
                    </div>
                </div>
                <footer className="flex justify-end space-x-4 pt-4 border-t border-gray-700">
                    <button type="button" onClick={onClose} className="px-4 py-2 bg-gray-600 rounded-md hover:bg-gray-500">Cancelar</button>
                    <button type="submit" className="px-4 py-2 bg-red-600 rounded-md hover:bg-red-700">Guardar</button>
                </footer>
            </form>
        </Modal>
    );
};


// --- From components/modals/UnitNomenclatureModal.tsx ---
const UnitNomenclatureModal = ({ isOpen, onClose, zones, onOpenAdd, onOpenEdit, onDelete }) => {
    const [searchTerm, setSearchTerm] = useState('');

    const allUnits = useMemo(() => {
        return zones.flatMap(zone =>
            zone.stations.flatMap(station =>
                station.units.map(unit => ({
                    ...unit,
                    stationName: station.name,
                    stationId: station.id,
                    zoneName: zone.name,
                    zoneId: zone.id
                }))
            )
        );
    }, [zones]);
    
    const filteredUnits = useMemo(() => {
        if (!searchTerm) return allUnits;
        const lowercasedFilter = searchTerm.toLowerCase();
        return allUnits.filter(unit =>
            unit.id.toLowerCase().includes(lowercasedFilter) ||
            unit.type.toLowerCase().includes(lowercasedFilter) ||
            unit.stationName.toLowerCase().includes(lowercasedFilter) ||
            unit.zoneName.toLowerCase().includes(lowercasedFilter)
        );
    }, [searchTerm, allUnits]);

    return (
        <Modal isOpen={isOpen} onClose={onClose} title="Nomenclador de Unidades" size="4xl">
            <div className="flex flex-col h-[70vh]">
                <p className="text-sm text-gray-400 mb-4">Gestionar el parque automotor.</p>
                <div className="flex justify-between items-center mb-4">
                    <div className="relative w-full max-w-xs">
                        <input
                            type="text"
                            placeholder="Buscar por nombre, ID, interno, estación, tipo..."
                            value={searchTerm}
                            onChange={e => setSearchTerm(e.target.value)}
                            className="w-full bg-gray-900 border border-gray-600 rounded-md p-2 pl-10 focus:ring-red-500 focus:border-red-500"
                        />
                        <SearchIcon className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
                    </div>
                    <button onClick={onOpenAdd} className="flex items-center px-4 py-2 text-sm font-semibold text-white bg-red-600 rounded-md hover:bg-red-700">
                        <PlusIcon className="w-5 h-5 mr-2" />
                        Agregar Unidad
                    </button>
                </div>
                
                <div className="flex-grow overflow-y-auto">
                    <table className="w-full text-sm text-left text-gray-400">
                        <thead className="text-xs text-gray-300 uppercase bg-gray-700 sticky top-0">
                            <tr>
                                <th scope="col" className="px-6 py-3">Nombre (ID)</th>
                                <th scope="col" className="px-6 py-3">N° Interno</th>
                                <th scope="col" className="px-6 py-3">Tipo</th>
                                <th scope="col" className="px-6 py-3">Estación / Zona</th>
                                <th scope="col" className="px-6 py-3">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {filteredUnits.map(unit => (
                                <tr key={unit.id} className="bg-gray-800 border-b border-gray-700 hover:bg-gray-600">
                                    <th scope="row" className="px-6 py-4 font-medium text-white whitespace-nowrap">
                                        {unit.id}
                                    </th>
                                    <td className="px-6 py-4">{unit.internalNumber || '-'}</td>
                                    <td className="px-6 py-4">{unit.type}</td>
                                    <td className="px-6 py-4">{unit.stationName} <br /> <span className="text-xs text-gray-500">{unit.zoneName}</span></td>
                                    <td className="px-6 py-4">
                                        <div className="flex space-x-3">
                                            <button onClick={() => onOpenEdit(unit)} className="text-blue-400 hover:text-blue-300"><EditIcon className="w-5 h-5"/></button>
                                            <button onClick={() => onDelete(unit.id)} className="text-red-400 hover:text-red-300"><TrashIcon className="w-5 h-5"/></button>
                                        </div>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        </Modal>
    );
};

// --- From components/modals/PersonnelModal.tsx ---
const PersonnelForm = ({ personnel, onSave, onCancel }) => {
    const [formData, setFormData] = useState({
        lp: '',
        rank: '',
        lastName: '',
        firstName: '',
    });

    useEffect(() => {
        if (personnel) {
            setFormData(personnel);
        } else {
            setFormData({ lp: '', rank: '', lastName: '', firstName: '' });
        }
    }, [personnel]);

    const handleChange = (e) => {
        const { name, value } = e.target;
        setFormData(prev => ({ ...prev, [name]: value }));
    };

    const handleSubmit = (e) => {
        e.preventDefault();
        onSave(formData);
    };
    
    const isEditing = !!personnel;

    return (
        <form onSubmit={handleSubmit} className="bg-gray-700 p-4 rounded-lg mb-4 space-y-4">
             <h3 className="text-lg font-semibold text-white">{isEditing ? 'Editar Personal' : 'Agregar Nuevo Personal'}</h3>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <input name="lp" value={formData.lp} onChange={handleChange} placeholder="LP" disabled={isEditing} required className="bg-gray-800 border border-gray-600 rounded-md p-2 focus:ring-red-500 focus:border-red-500 disabled:opacity-50"/>
                <input name="rank" value={formData.rank} onChange={handleChange} placeholder="Rango" required className="bg-gray-800 border border-gray-600 rounded-md p-2 focus:ring-red-500 focus:border-red-500" />
                <input name="lastName" value={formData.lastName} onChange={handleChange} placeholder="Apellido" required className="bg-gray-800 border border-gray-600 rounded-md p-2 focus:ring-red-500 focus:border-red-500" />
                <input name="firstName" value={formData.firstName} onChange={handleChange} placeholder="Nombre" required className="bg-gray-800 border border-gray-600 rounded-md p-2 focus:ring-red-500 focus:border-red-500" />
            </div>
            <div className="flex justify-end space-x-3">
                <button type="button" onClick={onCancel} className="px-4 py-2 bg-gray-600 rounded-md hover:bg-gray-500">Cancelar</button>
                <button type="submit" className="px-4 py-2 bg-red-600 rounded-md hover:bg-red-700">{isEditing ? 'Guardar Cambios' : 'Agregar Personal'}</button>
            </div>
        </form>
    );
};
const PersonnelModal = ({ isOpen, onClose, personnelList, onAdd, onUpdate, onDelete }) => {
    const [searchTerm, setSearchTerm] = useState('');
    const [isFormOpen, setIsFormOpen] = useState(false);
    const [editingPersonnel, setEditingPersonnel] = useState(null);

    const filteredPersonnel = useMemo(() => {
        if (!searchTerm) return personnelList;
        const lowercasedFilter = searchTerm.toLowerCase();
        return personnelList.filter(p =>
            p.lp.toLowerCase().includes(lowercasedFilter) ||
            p.rank.toLowerCase().includes(lowercasedFilter) ||
            p.lastName.toLowerCase().includes(lowercasedFilter) ||
            p.firstName.toLowerCase().includes(lowercasedFilter)
        );
    }, [searchTerm, personnelList]);
    
    const handleAddNew = () => {
        setEditingPersonnel(null);
        setIsFormOpen(true);
    };
    
    const handleEdit = (personnel) => {
        setEditingPersonnel(personnel);
        setIsFormOpen(true);
    };

    const handleSave = (personnel) => {
        if(editingPersonnel) {
            onUpdate(personnel);
        } else {
            onAdd(personnel);
        }
        setIsFormOpen(false);
        setEditingPersonnel(null);
    };
    
    const handleCancel = () => {
        setIsFormOpen(false);
        setEditingPersonnel(null);
    };

    return (
        <Modal isOpen={isOpen} onClose={onClose} title="Gestionar Personal" size="4xl">
            <div className="flex flex-col h-[70vh]">
                <div className="flex justify-between items-center mb-4">
                    <div className="relative w-full max-w-xs">
                        <input
                            type="text"
                            placeholder="Buscar por LP, rango, nombre..."
                            value={searchTerm}
                            onChange={e => setSearchTerm(e.target.value)}
                            className="w-full bg-gray-900 border border-gray-600 rounded-md p-2 pl-10 focus:ring-red-500 focus:border-red-500"
                        />
                        <SearchIcon className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
                    </div>
                    {!isFormOpen && (
                        <button onClick={handleAddNew} className="flex items-center px-4 py-2 text-sm font-semibold text-white bg-red-600 rounded-md hover:bg-red-700">
                            <PlusIcon className="w-5 h-5 mr-2" />
                            Agregar Personal
                        </button>
                    )}
                </div>

                {isFormOpen && <PersonnelForm personnel={editingPersonnel} onSave={handleSave} onCancel={handleCancel} />}
                
                <div className="flex-grow overflow-y-auto">
                    <table className="w-full text-sm text-left text-gray-400">
                        <thead className="text-xs text-gray-300 uppercase bg-gray-700 sticky top-0">
                            <tr>
                                <th scope="col" className="px-6 py-3">LP</th>
                                <th scope="col" className="px-6 py-3">Rango</th>
                                <th scope="col" className="px-6 py-3">Apellido</th>
                                <th scope="col" className="px-6 py-3">Nombre</th>
                                <th scope="col" className="px-6 py-3">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {filteredPersonnel.map(p => (
                                <tr key={p.lp} className="bg-gray-800 border-b border-gray-700 hover:bg-gray-600">
                                    <th scope="row" className="px-6 py-4 font-medium text-white whitespace-nowrap">{p.lp}</th>
                                    <td className="px-6 py-4">{p.rank}</td>
                                    <td className="px-6 py-4">{p.lastName}</td>
                                    <td className="px-6 py-4">{p.firstName}</td>
                                    <td className="px-6 py-4">
                                        <div className="flex space-x-3">
                                            <button onClick={() => handleEdit(p)} className="text-blue-400 hover:text-blue-300"><EditIcon className="w-5 h-5"/></button>
                                            <button onClick={() => onDelete(p.lp)} className="text-red-400 hover:text-red-300"><TrashIcon className="w-5 h-5"/></button>
                                        </div>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        </Modal>
    );
};

// --- From components/modals/AssignOfficerModal.tsx ---
const AssignOfficerModal = ({ unit, personnelList, isOpen, onClose, onSave }) => {
    const [searchTerm, setSearchTerm] = useState('');
    const [selectedOfficer, setSelectedOfficer] = useState(null);
    const [personnelCount, setPersonnelCount] = useState(unit?.personnelCount?.toString() || '');

    useEffect(() => {
        if(unit) {
            setSelectedOfficer(unit.officerInCharge);
            setPersonnelCount(unit.personnelCount?.toString() || '');
            if(unit.officerInCharge) {
                setSearchTerm(`${unit.officerInCharge.name.toUpperCase()}, ${unit.officerInCharge.rank}`);
            } else {
                setSearchTerm('');
            }
        }
    }, [unit]);

    const filteredPersonnel = useMemo(() => {
        if (!searchTerm || (selectedOfficer && searchTerm === `${selectedOfficer.name.toUpperCase()}, ${selectedOfficer.rank}`)) return [];
        return personnelList.filter(p =>
            p.lastName.toLowerCase().includes(searchTerm.toLowerCase()) ||
            p.firstName.toLowerCase().includes(searchTerm.toLowerCase()) ||
            p.lp.includes(searchTerm)
        ).slice(0, 5);
    }, [searchTerm, personnelList, selectedOfficer]);

    const handleSave = () => {
        if (unit && selectedOfficer && personnelCount) {
            onSave(unit.id, selectedOfficer, parseInt(personnelCount, 10));
        }
    };
    
    const handleSelectOfficer = (officer) => {
        setSelectedOfficer(officer);
        setSearchTerm(`${officer.lastName.toUpperCase()}, ${officer.firstName}`);
    }

    if(!unit) return null;

    return (
        <Modal isOpen={isOpen} onClose={onClose} title="Asignar Oficial">
            <div className="space-y-6">
                <p className="font-semibold">Unidad: <span className="font-bold text-yellow-400">{unit.id}</span></p>

                <div className="bg-gray-700 p-4 rounded-md">
                    <label htmlFor="search-officer" className="block text-sm font-medium text-blue-300 mb-2">Oficial a Cargo</label>
                    <p className="text-xs text-gray-400 mb-2">Buscar Oficial (por Nombre, Apellido o LP)</p>
                    <input
                        id="search-officer"
                        type="text"
                        value={searchTerm}
                        onChange={(e) => setSearchTerm(e.target.value)}
                        className="w-full bg-gray-800 border border-gray-600 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500"
                    />
                    {filteredPersonnel.length > 0 && (
                        <ul className="mt-2 bg-gray-900 border border-gray-600 rounded-md">
                            {filteredPersonnel.map(p => (
                                <li
                                    key={p.lp}
                                    onClick={() => handleSelectOfficer(p)}
                                    className="p-2 hover:bg-gray-700 cursor-pointer border-b border-gray-700 last:border-b-0"
                                >
                                    <p className="font-bold">{p.lastName.toUpperCase()}, {p.firstName}</p>
                                    <p className="text-xs text-gray-400">{p.rank} - LP: {p.lp}</p>
                                </li>
                            ))}
                        </ul>
                    )}
                </div>

                <div className="bg-gray-700 p-4 rounded-md">
                    <label htmlFor="personnel-count" className="block text-sm font-medium text-blue-300 mb-2">Dotación de la Unidad</label>
                    <p className="text-xs text-gray-400 mb-2">Cantidad Total de Personal</p>
                    <input
                        id="personnel-count"
                        type="number"
                        value={personnelCount}
                        onChange={(e) => setPersonnelCount(e.target.value)}
                        className="w-full bg-gray-800 border border-gray-600 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500"
                    />
                </div>
                
                 <div className="bg-gray-700 p-4 rounded-md">
                    <label htmlFor="add-personnel" className="block text-sm font-medium text-blue-300 mb-2">Agregar Personal a la Lista (Opcional)</label>
                    <div className="flex">
                        <input
                            id="add-personnel"
                            type="text"
                            placeholder="Nombre y Apellido"
                            className="w-full bg-gray-800 border border-gray-600 rounded-l-md p-2 focus:ring-blue-500 focus:border-blue-500"
                        />
                        <button className="bg-blue-600 p-2 rounded-r-md hover:bg-blue-700">
                            <PlusIcon className="w-6 h-6 text-white"/>
                        </button>
                    </div>
                </div>

                <footer className="flex justify-end space-x-4 pt-4">
                    <button onClick={onClose} className="px-4 py-2 bg-gray-600 rounded-md hover:bg-gray-500">Cancelar</button>
                    <button onClick={handleSave} disabled={!selectedOfficer || !personnelCount} className="px-4 py-2 bg-red-600 rounded-md hover:bg-red-700 disabled:bg-gray-500 disabled:cursor-not-allowed">Guardar Cambios</button>
                </footer>
            </div>
        </Modal>
    );
};


// --- From components/modals/UpdateStatusModal.tsx ---
const UpdateStatusModal = ({ unit, isOpen, onClose, onSave }) => {
    const [selectedStatus, setSelectedStatus] = useState(unit?.status);
    const [reason, setReason] = useState(unit?.statusReason || '');

    useEffect(() => {
        if (unit) {
            setSelectedStatus(unit.status);
            setReason(unit.statusReason || '');
        }
    }, [unit]);

    const statusOptions = [
        { label: 'Integrando Fuerza o Servicio', value: UnitStatus.InServiceActive, color: 'violet-500' },
        { label: 'Para Servicio', value: UnitStatus.InService, color: 'white' },
        { label: 'Reserva', value: UnitStatus.Reserve, color: 'green-500' },
        { label: 'Alternativa', value: UnitStatus.Alternative, color: 'yellow-500' },
        { label: 'A Prestamo', value: UnitStatus.OnLoan, color: 'cyan-500' },
        { label: 'Fuera de Servicio', value: UnitStatus.OutOfService, color: 'red-500' },
    ];

    const handleSave = () => {
        onSave(unit.id, selectedStatus, reason);
    };

    if(!unit) return null;

    return (
        <Modal isOpen={isOpen} onClose={onClose} title="Actualizar Estado">
            <div className="space-y-6">
                <p className="font-semibold">Unidad: <span className="font-bold text-yellow-400">{unit.id}</span></p>

                <div>
                    <label className="block text-sm font-medium text-blue-300 mb-2">Seleccionar Nuevo Estado</label>
                    <div className="space-y-2">
                        {statusOptions.map(option => (
                            <button
                                key={option.value + option.label}
                                onClick={() => setSelectedStatus(option.value)}
                                className={`w-full text-left p-3 rounded-md flex items-center transition-all duration-200 ${selectedStatus === option.value ? `ring-2 ring-offset-2 ring-offset-gray-800 ring-${option.color}` : 'bg-gray-700 hover:bg-gray-600'}`}
                            >
                                <span className={`w-4 h-4 rounded-full mr-3 bg-${option.color}`}></span>
                                {option.label}
                            </button>
                        ))}
                    </div>
                </div>

                {selectedStatus === UnitStatus.OutOfService && (
                     <div className="bg-gray-700 p-4 rounded-md">
                        <label htmlFor="reason" className="block text-sm font-medium text-blue-300 mb-2">Motivo (Requerido para F/S)</label>
                        <input
                            id="reason"
                            type="text"
                            value={reason}
                            onChange={(e) => setReason(e.target.value)}
                            placeholder="Ej. Falta de personal, Problema mecánico"
                            className="w-full bg-gray-800 border border-gray-600 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500"
                        />
                    </div>
                )}
                
                <footer className="flex justify-end space-x-4 pt-4">
                    <button onClick={onClose} className="px-4 py-2 bg-gray-600 rounded-md hover:bg-gray-500">Cancelar</button>
                    <button onClick={handleSave} className="px-4 py-2 bg-red-600 rounded-md hover:bg-red-700">Guardar Cambios</button>
                </footer>
            </div>
        </Modal>
    );
};


// --- From components/Header.tsx ---
const Header = ({ onOpenModal }) => {
    return (
        <header className="bg-gray-800 shadow-md">
            <div className="flex items-center justify-between p-4">
                <div className="flex items-center space-x-4">
                    <h1 className="text-xl font-bold text-red-500 uppercase tracking-wider">Unidades de Bomberos</h1>
                    <nav className="hidden md:flex items-center space-x-2">
                        <button onClick={() => onOpenModal('nomenclature')} className="flex items-center px-3 py-2 text-sm font-medium text-gray-300 bg-gray-700 rounded-md hover:bg-gray-600">
                            <ListIcon className="w-4 h-4 mr-2" />
                            Nomenclador
                        </button>
                        <button onClick={() => onOpenModal('personnel')} className="flex items-center px-3 py-2 text-sm font-medium text-gray-300 bg-gray-700 rounded-md hover:bg-gray-600">
                            <UserIcon className="w-4 h-4 mr-2" />
                            Personal
                        </button>
                        <button className="flex items-center px-3 py-2 text-sm font-medium text-gray-300 bg-gray-700 rounded-md hover:bg-gray-600">
                           <ListIcon className="w-4 h-4 mr-2" />
                            Internos
                        </button>
                        <button className="flex items-center px-3 py-2 text-sm font-medium text-gray-300 bg-gray-700 rounded-md hover:bg-gray-600">
                            <BookIcon className="w-4 h-4 mr-2" />
                            Registros
                        </button>
                         <button className="flex items-center px-3 py-2 text-sm font-medium text-gray-300 bg-gray-700 rounded-md hover:bg-gray-600">
                            <FileTextIcon className="w-4 h-4 mr-2" />
                            PDF
                        </button>
                    </nav>
                </div>
                <div className="flex items-center space-x-4">
                    <div className="text-right">
                        <p className="font-semibold text-white">O.C.O.B.</p>
                        <p className="text-xs text-gray-400">Admin</p>
                    </div>
                    <button className="p-2 bg-gray-700 rounded-md hover:bg-gray-600">
                        <ArrowRightIcon className="w-5 h-5" />
                    </button>
                     <button className="p-2 bg-gray-700 rounded-md hover:bg-gray-600">
                        <LogOutIcon className="w-5 h-5" />
                    </button>
                </div>
            </div>
        </header>
    );
};


// --- From components/UnitCard.tsx ---
const StatusBadge = ({ status, unitId }) => {
    const statusText = {
        [UnitStatus.InService]: 'Para Servicio',
        [UnitStatus.InServiceActive]: 'Integrando Fuerza',
        [UnitStatus.OutOfService]: 'Fuera de Servicio',
        [UnitStatus.Reserve]: 'Reserva',
        [UnitStatus.OnLoan]: 'A Prestamo',
        [UnitStatus.Alternative]: 'Alternativa',
    };

    const statusStyles = {
        [UnitStatus.InServiceActive]: 'bg-violet-500 text-white',
        [UnitStatus.OutOfService]: 'bg-red-500 text-white',
        [UnitStatus.Reserve]: 'bg-green-500 text-white',
        [UnitStatus.OnLoan]: 'bg-cyan-500 text-white',
        [UnitStatus.Alternative]: 'bg-yellow-500 text-black',
    };

    const statusDot = {
        [UnitStatus.InService]: 'bg-white',
        [UnitStatus.InServiceActive]: 'bg-violet-500',
        [UnitStatus.OutOfService]: 'bg-red-500',
        [UnitStatus.Reserve]: 'bg-green-500',
        [UnitStatus.OnLoan]: 'bg-cyan-500',
        [UnitStatus.Alternative]: 'bg-yellow-500',
    };

    const hasBadge = status !== UnitStatus.InService;

    return (
        <div className="flex items-center space-x-2">
            <span className={`w-3 h-3 rounded-full ${statusDot[status]}`}></span>
            <p className="font-bold text-lg text-gray-200">{unitId}</p>
            {hasBadge && <span className={`px-2 py-0.5 text-xs font-semibold rounded-full ${statusStyles[status]}`}>{statusText[status]}</span>}
        </div>
    );
};
const UnitCard = ({ unit, onAssign, onUpdateStatus }) => {
    const hasAssignment = unit.officerInCharge && unit.personnelCount;

    return (
        <div className="bg-gray-800 rounded-lg shadow-lg p-4 flex flex-col justify-between h-56 transition-all duration-300 hover:shadow-cyan-500/50 hover:ring-1 hover:ring-cyan-500">
            <div>
                <div className="flex justify-between items-start mb-2">
                    <div>
                        <StatusBadge status={unit.status} unitId={unit.id} />
                        <p className={`text-sm font-medium ${unit.status === UnitStatus.OutOfService ? 'text-red-400' : 'text-red-500'}`}>{unit.type}</p>
                    </div>
                </div>

                <div className="text-sm text-gray-400 h-16">
                    {unit.status === UnitStatus.OutOfService ? (
                        <div className="flex flex-col justify-start h-full pt-1">
                            <p className="font-semibold text-red-400 uppercase">Motivo F/S:</p>
                            <p className="text-gray-200 italic truncate" title={unit.statusReason || ''}>{unit.statusReason || 'No especificado'}</p>
                        </div>
                    ) : hasAssignment ? (
                        <>
                            <p className="font-semibold text-gray-300">OFICIAL A CARGO</p>
                            <p className="text-yellow-400 font-bold">{unit.officerInCharge?.rank} {unit.officerInCharge?.name}</p>
                            <p className="text-xs">LP: {unit.officerInCharge?.lp}</p>
                            <div className="flex items-center mt-1">
                                <UsersIcon className="w-4 h-4 mr-2" />
                                <span className="font-bold">{unit.personnelCount}</span>
                            </div>
                        </>
                    ) : (
                        <div className="flex items-center justify-center h-full">
                            <p>Sin Asignación</p>
                        </div>
                    )}
                </div>
            </div>

            <div className="flex items-center justify-between mt-4">
                <div className="flex space-x-2">
                    <button className="p-2 bg-gray-700 rounded-md hover:bg-gray-600"><CogIcon className="w-4 h-4" /></button>
                    <button className="p-2 bg-gray-700 rounded-md hover:bg-gray-600"><UserIcon className="w-4 h-4" /></button>
                    <button onClick={onUpdateStatus} className="p-2 bg-gray-700 rounded-md hover:bg-gray-600"><PlusIcon className="w-4 h-4" /></button>
                </div>
                {hasAssignment ? (
                     <button onClick={onAssign} className="flex items-center px-4 py-2 text-sm font-semibold text-white bg-blue-600 rounded-md hover:bg-blue-700">
                        <EditIcon className="w-4 h-4 mr-2" />
                        Editar
                    </button>
                ) : (
                    <button onClick={onAssign} className="flex items-center px-4 py-2 text-sm font-semibold text-white bg-red-600 rounded-md hover:bg-red-700">
                        <PlusIcon className="w-4 h-4 mr-2" />
                        Asignar
                    </button>
                )}
            </div>
        </div>
    );
};


// --- From components/StationSection.tsx ---
const StationSection = ({ station, onAssign, onUpdateStatus }) => {
    return (
        <section className="mb-12">
            <h3 className="text-lg font-semibold text-gray-400 mb-4 pb-2 border-b-2 border-gray-700">{station.name}</h3>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                {station.units.map(unit => (
                    <UnitCard 
                        key={unit.id} 
                        unit={unit}
                        onAssign={() => onAssign(unit)}
                        onUpdateStatus={() => onUpdateStatus(unit)}
                    />
                ))}
            </div>
        </section>
    );
};

// --- From App.tsx ---
const App = () => {
    const [zones, setZones] = useState(ZONES_DATA);
    const [personnel, setPersonnel] = useState(PERSONNEL_DATA);
    const [activeModal, setActiveModal] = useState(null);
    const [selectedUnit, setSelectedUnit] = useState(null);
    const [unitToManage, setUnitToManage] = useState(null); // For Add/Edit Unit Modal

    const handleOpenModal = (modalType, unit = null) => {
        setSelectedUnit(unit);
        setActiveModal(modalType);
    };

    const handleCloseModal = () => {
        setActiveModal(null);
        setSelectedUnit(null);
    };

    const handleAssignOfficer = (unitId, officer, personnelCount) => {
        const newZones = zones.map(zone => ({
            ...zone,
            stations: zone.stations.map(station => ({
                ...station,
                units: station.units.map(unit =>
                    unit.id === unitId
                        ? { ...unit, officerInCharge: { rank: officer.rank, name: officer.lastName, lp: officer.lp }, personnelCount }
                        : unit
                ),
            })),
        }));
        setZones(newZones);
        handleCloseModal();
    };

    const handleUpdateStatus = (unitId, status, reason) => {
        const newZones = zones.map(zone => ({
            ...zone,
            stations: zone.stations.map(station => ({
                ...station,
                units: station.units.map(unit =>
                    unit.id === unitId
                        ? { ...unit, status, statusReason: reason }
                        : unit
                ),
            })),
        }));
        setZones(newZones);
        handleCloseModal();
    };

    const handleAddPersonnel = (newPersonnel) => {
        if (personnel.some(p => p.lp === newPersonnel.lp)) {
            alert("Error: El LP ya existe.");
            return;
        }
        setPersonnel(prev => [...prev, newPersonnel]);
    };

    const handleUpdatePersonnel = (updatedPersonnel) => {
        setPersonnel(prev => prev.map(p => p.lp === updatedPersonnel.lp ? updatedPersonnel : p));
    };

    const handleDeletePersonnel = (lp) => {
        setPersonnel(prev => prev.filter(p => p.lp !== lp));
    };

    // --- New Handlers for Unit Management ---
    const handleOpenAddUnitModal = () => {
        handleCloseModal(); // Close nomenclature if open
        setUnitToManage({ mode: 'add', unit: null });
    };

    const handleOpenEditUnitModal = (unitToEdit) => {
        handleCloseModal(); // Close nomenclature if open
        setUnitToManage({ mode: 'edit', unit: unitToEdit });
    };


    const handleDeleteUnit = (unitIdToDelete) => {
        if (!window.confirm(`¿Está seguro que desea eliminar la unidad ${unitIdToDelete}?`)) {
            return;
        }
        const newZones = JSON.parse(JSON.stringify(zones));
        let unitFoundAndDeleted = false;
        for (const zone of newZones) {
            for (const station of zone.stations) {
                const unitIndex = station.units.findIndex(u => u.id === unitIdToDelete);
                if (unitIndex !== -1) {
                    station.units.splice(unitIndex, 1);
                    unitFoundAndDeleted = true;
                    break;
                }
            }
            if (unitFoundAndDeleted) break;
        }
        setZones(newZones);
    };


    const handleSaveUnit = (savedUnitData, originalUnitData) => {
        const newZones = JSON.parse(JSON.stringify(zones)); // Deep copy to ensure immutability

        const newUnit = {
            ...originalUnitData, // Carry over existing data like officer, status etc.
            id: savedUnitData.id,
            type: savedUnitData.type,
            internalNumber: savedUnitData.internalNumber,
            // Ensure these fields exist, defaulting if they don't
            status: originalUnitData?.status || UnitStatus.InService,
            officerInCharge: originalUnitData?.officerInCharge || null,
            personnelCount: originalUnitData?.personnelCount || null,
        };

        // --- Handle Edit Mode (including moving stations) ---
        if (unitToManage.mode === 'edit' && originalUnitData) {
            // 1. Remove the original unit from its old position
            let unitRemoved = false;
            for (const zone of newZones) {
                for (const station of zone.stations) {
                    const unitIndex = station.units.findIndex(u => u.id === originalUnitData.id);
                    if (unitIndex !== -1) {
                        station.units.splice(unitIndex, 1);
                        unitRemoved = true;
                        break;
                    }
                }
                if (unitRemoved) break;
            }
        }

        // --- Add the new/updated unit to its correct new station ---
        let unitAdded = false;
        for (const zone of newZones) {
            if (zone.id === savedUnitData.zoneId) {
                for (const station of zone.stations) {
                    if (station.id === savedUnitData.stationId) {
                        station.units.push(newUnit);
                        unitAdded = true;
                        break;
                    }
                }
            }
            if (unitAdded) break;
        }

        setZones(newZones);
        setUnitToManage(null); // Close the modal
    };


    return (
        <div className="min-h-screen bg-gray-900 text-gray-300">
            <Header onOpenModal={(modalType) => handleOpenModal(modalType)} />
            <main className="p-8">
                {zones.map(zone => (
                    <div key={zone.id} className="mb-8">
                        <h2 className="text-2xl font-bold text-red-500 mb-6 uppercase tracking-wide">{zone.name}</h2>
                        {zone.stations.map(station => (
                            <StationSection
                                key={station.id}
                                station={station}
                                onAssign={(unit) => handleOpenModal('assignOfficer', unit)}
                                onUpdateStatus={(unit) => handleOpenModal('updateStatus', unit)}
                            />
                        ))}
                    </div>
                ))}
            </main>

            {selectedUnit && activeModal === 'assignOfficer' && (
                <AssignOfficerModal
                    unit={selectedUnit}
                    personnelList={personnel}
                    isOpen={activeModal === 'assignOfficer'}
                    onClose={handleCloseModal}
                    onSave={handleAssignOfficer}
                />
            )}
            {selectedUnit && activeModal === 'updateStatus' && (
                <UpdateStatusModal
                    unit={selectedUnit}
                    isOpen={activeModal === 'updateStatus'}
                    onClose={handleCloseModal}
                    onSave={handleUpdateStatus}
                />
            )}
             {activeModal === 'nomenclature' && (
                <UnitNomenclatureModal
                    isOpen={activeModal === 'nomenclature'}
                    onClose={handleCloseModal}
                    zones={zones}
                    onOpenAdd={handleOpenAddUnitModal}
                    onOpenEdit={handleOpenEditUnitModal}
                    onDelete={handleDeleteUnit}
                />
            )}
            {activeModal === 'personnel' && (
                <PersonnelModal
                    isOpen={activeModal === 'personnel'}
                    onClose={handleCloseModal}
                    personnelList={personnel}
                    onAdd={handleAddPersonnel}
                    onUpdate={handleUpdatePersonnel}
                    onDelete={handleDeletePersonnel}
                />
            )}
            
            {unitToManage && (
              <AddEditUnitModal
                isOpen={!!unitToManage}
                onClose={() => setUnitToManage(null)}
                onSave={handleSaveUnit}
                unitData={unitToManage}
                allZones={zones}
              />
            )}
        </div>
    );
};

// --- Render the App ---
const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);

    </script>
  </body>
</html>